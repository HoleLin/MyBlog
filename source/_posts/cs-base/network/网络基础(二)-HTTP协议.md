---
title: 网络基础-HTTP协议
date: 2021-10-20 14:27:40
index_img: /img/cover/Network.jpg
cover: /img/cover/Network.jpg
tags:
categories:
- 网络
- HTTP
updated:
type:
comments:
description:
keywords:
top_img:
mathjax:
katex:
aside:
aplayer:
highlight_shrink:
---
### 参考文献

* 编程必备基础 大话HTTP协议[慕课]
* [趣谈网络协议](https://time.geekbang.org/column/intro/85)
* WireShark数据包分析实战(第三版)
* [TCP-RFC793](https://www.ietf.org/rfc/rfc793.txt)
* TCP/IP详解 卷1: 协议
* 图解网络-小林coding
* [UDP-RFC768](https://www.ietf.org/rfc/rfc0768)

### HTTP

<img src="https://www.holelin.cn/img/cs-base/http/HTTP%E6%A6%82%E8%A7%88.png" alt="img" style="zoom:67%;" />

<img src="https://www.holelin.cn/img/cs-base/http/HTTP%E5%8D%8F%E8%AE%AE.png" alt="img" style="zoom:67%;" />

#### 历史

* 20世纪60年代,美国国防部高等研究计划署(ARPA)建立ARPA网,它被认为是如今互联网的始祖.
* 1989年,任职于欧洲核子研究中心(CERN)的Tim Berners-Lee发表了一篇论文,提出了在互联网上构建超链接文档系统的构想.这篇论文中确立了三项关键技术:
  * `URI`: 即统一资源标识符,作为互联网上资源的唯一身份.
  * `HTML`: 即超文本标记语言,描述超文本文档.
  * `HTTP`: 即超文本传输协议,用来传输超文本.
* HTTP/0.9,结构比较简单，为了便于服务器和客户端处理，它也采用了纯文本格式。
* HTTP/1.0,HTTP/1.0 版本在 1996 年正式发布。多方面增强了0.9版本:
  * 增加了 HEAD、POST 等新方法；
  * 增加了响应状态码，标记可能的错误原因；
  * 引入了协议版本号概念；
  * 引入了 HTTP Header（头部）的概念，让 HTTP 处理请求和响应更加灵活；
  * 传输的数据不再仅限于文本。
* HTTP/1.1,[RFC2616](https://www.rfc-editor.org/rfc/inline-errata/rfc2616.html),
  * HTTP/1.1 主要的变更点有:
    * 增加了 PUT、DELETE 等新的方法；
    * 增加了缓存管理和控制；
    * 明确了连接管理，允许持久连接；
    * 允许响应数据分块（chunked），利于传输大文件；
    * 强制要求 Host 头，让互联网主机托管成为可能。
  * 不过由于 HTTP/1.1 太过庞大和复杂，所以在 2014 年又做了一次修订，原来的一个大文档被拆分成了六份较小的文档，编号为 7230-7235，优化了一些细节，但此外没有任何实质性的改动。
* HTTP/2,HTTP/2 的制定充分考虑了现今互联网的现状：宽带、移动、不安全，在高度兼容 HTTP/1.1 的同时在性能改善方面做了很大努力, 基于 Google 的 SPDY 协议.
  * 主要的特点有:
    * 二进制协议，不再是纯文本；
    * 可发起多个请求，废弃了 1.1 里的管道；
    * 使用专用算法压缩头部，减少数据传输量；
    * 允许服务器主动向客户端推送数据；
    * 增强了安全性，“事实上”要求加密通信。
* HTTP/3,2018 年，互联网标准化组织 IETF 提议将“HTTP over QUIC”更名为“HTTP/3”并获得批准，HTTP/3 正式进入了标准化制订阶段,基于 Google 的 QUIC 协议

#### HTTP协议概述

* 超文本传输协议(HTTP)是一种**通信协议**,它允许将超文本标记语言(HTML)文档从Web服务器传送到客户端的浏览器;

  > 超文本传输协议＝超文本＋传输＋协议，协议即约定，HTTP就是约定超文本怎么传输的。初心就是分享信息，所以，简单、开放、有求有应，只针对文本，后来出现了音频、视频、动画、图片、超链接这些玩意，比纯文本复杂了一些，不过初心不改，所以，原则未变，只是需要调整一下适应这些正当其时的需求而已。

* HTTP是一个属于**应用层的面向对象的协议**,由于其简洁,快速的方式,适用于分布式超媒体信息系统,它于1990年提出,经过几年的使用与发展,得到不断地完善和扩展;

* HTTP是一个在计算机世界里面专门在**两点之间传输**文字,图片,音频,视频等**超文本**数据的**约定和规范**

* 在HTTP协议里,浏览器的角色被称为"User Agent"即"用户代理",意思是作为访问者的"代理"来发我HTTP请求.

* CDN(**Content Delivery Network**): 即内容分发网络,它应用了HTTP协议里的缓存和代理技术,代替源站响应客户端的读请求.

  * 好处: 它可以缓存源站的数据,让浏览器的请求不用"千里迢迢"地到达源站服务器,直接在半路就可以获取响应.
  * CDN是互联网中的一项重要基础设施,除了基本的网络加速外,还提供负载均衡,安全防护,边缘计算,跨运营商网络等功能,能够成倍地放大源站服务器的服务能力.

* Web  Service 是一种由 W3C 定义的应用服务开发规范，使用 client-server 主从架构，通常使用 WSDL 定义服务接口，使用 HTTP 协议传输 XML 或 SOAP 消息，也就是说，它是**一个基于 Web（HTTP）的服务架构技术**，既可以运行在内网，也可以在适当保护后运行在外网。

* **WAF**意思是“网络应用防火墙”。与硬件“防火墙”类似，它是应用层面的“防火墙”，专门检测 HTTP 流量，是防护 Web 应用的安全技术。

  * WAF 通常位于 Web 服务器之前，可以阻止如 SQL 注入、跨站脚本等攻击，目前应用较多的一个开源项目是 ModSecurity，它能够完全集成进 Apache 或 Nginx。


#### HTTP状态码

|      | 具体含义                                                | 常见的状态码                                                 |
| ---- | ------------------------------------------------------- | ------------------------------------------------------------ |
| 1xx  | 提示信息,,表示目前是协议处理的中间状态,还需要后续的操作 |                                                              |
| 2xx  | 成功,报文已经收到并正确处理                             | 200[OK],204[Not Content],206[Partial Conent]                 |
| 3xx  | 重定向,资源位置发生变动,需要客户端重新发送请求          | 301[Moved Permantly],302[Foud],304[Not Modified]             |
| 4xx  | 客户端错误,请求报文有误,服务器无法处理                  | 400[Bad Request],403[Forbidden],404[Not Found]               |
| 5xx  | 服务器错误,服务器在处理请求时内部发生了错误             | 500[Internal Service Error],501[Not Implemented],502[Bad Gateway],503[Service Unavailable] |

* 206是应用于HTTP分块下载或断电续传,表示响应返回的body数据并不是资源的全部,而是其中的一部分,也是服务器处理成功的状态.
* 301表示永久重定向,说明请求的资源已经不存在了,需要改用新的URL再次访问.
* 302表示临时重定向,说明请求的资源还在,但暂时需要用拧一个URK来访问.
* 304不具有跳转的含义,表示资源未修改,重新定向已存在的缓冲文件,也称为缓冲重定向,用于缓存控制

####  HTTP数据传输过程

* **数据封装(Data Encapsulation)**是将**协议数据单元**(PDU)封装在一组协议头和尾中过程.	

![img](https://www.holelin.cn/img/cs-base/http/HTTP%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B.png)

* 发送端发送数据时,数据会从上层传输到下层,且每经过一层都会被打上该层的头部信息.而接收端接收数据时,数据会从下层传输到上层,传输前会把下层的头部信息删除.
* 数据发送处理过程
  * 应用层将数据交给传输层,传输层添加上TCP的控制信息(称为TCP头部),这个数据单元称为段(Segment),加上控制信息的过程称为封装.然后将段交给网络层.
  * 网络层接收到段,再添加上IP头部,这个数据单元称为包(Packet).然后,将包交给数据链路层.
  * 数据链路层接收到包,再添加上MAC头部和尾部,这个数据单元称为帧(Frame).然后,将帧交给物理层.
  * 物理层将接收到的数据转化为比特流,然后在网线中传输.
* 数据接收处理过程
  * 物理层接收到比特流,经过处理后将数据交给数据链路层.
  * 数据链路层将接收到数据转化为数据帧,再除去MAC头部和尾部,这个除去控制信息的过程称为解封装,然后将包交给网络层.
  * 网络层接收到包,再除去IP头部,然后将段交给传输层.
  * 传输层接收到段,再除去TCP头部,然后将数据交给应用层.

#### 