---
title: Wireshark-网络抓包(一)
date: 2021-09-28 14:47:46
index_img: /img/cover/Wireshark.jpeg
cover: /img/cover/Wireshark.jpeg
tags:
categories:
- 工具
- WireShark
updated:
type:
comments:
description:
keywords:
top_img:
mathjax:
katex:
aside:
aplayer:
highlight_shrink:
---

### 参考文献

* WireShark数据包分析实战(第三版)

#### 监听网络线路

#### 在交换式网络中进行嗅探

* 在一个交换式网络中从一个目标设备捕获网络流量的基本方法有四种:**端口镜像**,**集线器接出(hubbing out)**,**使用网络分流器**和**ARP缓存污染攻击**.
* 使用端口镜像,必须能够通过命令行或Web管理界面来访问目标设备所连接的交换机,并且该种交换机必须支持端口镜像的功能以及有一个空闲的端口.

##### 通用端口

| 制造商 | 命令                                                         |
| ------ | ------------------------------------------------------------ |
| 思科   | `set span <source port> <destination port>`                  |
| 凯创   | `set port mirroring create <source port> <destination port>` |
| 北电   | `port-mirroring mode mirror-port <source port> monitor-port <destination port>` |

#### 集线器输出

* 需要将目标设备和分析系统分段到同一网络段中,然后把它们直接插入到一个集线器上.

* 操作步骤
  * 找到目标设备所连接的交换机,并将目标设备连接网线从交换机拔掉.
  * 将目标设备的网线插入到你的集线器上.
  * 使用另一个网线,将你的嗅探分析器也连接到集线器上.
  * 从你的集线器连接一根网线到交换机上,将集线器连接到网络上.
* 这样操作完成后,目标设备和你的嗅探分析器连接到了同一个广播域中,所有从你的目标设备流入流出的网络流量都将在集线器中广播,从而让嗅探分析器可以捕获到这些数据包.

#### 网络分流器

* 网络分流器是一个硬件设备,可以将它放置在网络布线系统的两个端点之间,来捕获这两个端点之间的数据包.
* 网络分流器又分为2种基本类型:聚合的和非聚合的.这两种分流器都是安置在两个设备之间来嗅探所有流经的网络通信的.

#### ARP缓存污染

##### ARP查询过程

* 连接到以太网网络上计算机的ARP查询过程,是从一台计算机想要与另一台进行通信是开始的.发起通信的计算机首先检查自己的ARP缓存,查看它是否已经有对方IP地址对应的MAC地址.
* 如果不存在,它将往数据链路层广播地址`FF:FF:FF:FF:FF:FF`发送一个ARP广播请求包,作为一个广播数据包,它会被这个特定的以太网广播域上的每一台计算机接收,这个请求包会问道:"某某IP地址的MAC地址是什么?"
* 没有匹配到IP地址的计算机会简单的丢弃这个请求包.而目标计算机则选择答复这个数据包,通过ARP应答告知它的MAC地址.此时发起通信的计算机就获取到了数据链路层的寻址信息,便可以利用它与远端计算机进行通信,同时将这些信息保存在ARP缓存中,来加速以后的网络访问.

##### ARP缓存污染

* ARP缓存污染也被称为ARP欺骗,是一种在交换网络中监听流量的高级方法,这种方法通过发送包含虚假MAC地址(第二层)的ARP消息,来劫持其他计算机的流量.
* 它通常由攻击者使用,向客户端系统发送虚假地址和数据包,来获取特定的网络流量,或者对目标进行拒绝服务攻击(Dos),然而它可以是一种在交换式网络中捕获目标系统数据包的方法.

