---
title: 缓存设计
mermaid: true
date: 2021-07-10 21:45:39
tags:
categories:
updated:
type:
comments:
description:
keywords:
top_img:
mathjax:
katex:
aside:
aplayer:
highlight_shrink:
---

### 参考文献

#### 缓存的更新模式

##### `Cache Aside`

> 大致分为两个流程
>
> * 读取
> * 更新

* **读取**

  * 如果缓存中没有,则再从数据库中读取数据,获得数据后,再放入缓存;
  * 如果缓存中有,查询出来直接返回;

* **更新**

  * 先更新数据库里的数据,成功后,让缓存失效;
  * **为什么是让缓存失效,而不是更新缓存呢?**
    * 主要是因为两个并发写操作会导致脏数据.当有两个线程A和B,分别要将资源A的值修改为1和2,线程A先到达数据库把数据更新为1,但还没更新缓存,由于时间片用完了,此时线程获得CPU,并在这期间把数据库资源A的值和缓存的值都更新为2,线程B结束后,线程A重新获取CPU,再执行更新缓存操作,把资源A的值更新为1,线程A结束.
    * 此时数据库中资源A的值为2,而缓存中的A值为1,产生了数据不一致的问题.让缓存失效而不是更新缓存则不会出现这个问题.

##### `Read/Write Through` 

##### `Write Behind Caching`



  

  

